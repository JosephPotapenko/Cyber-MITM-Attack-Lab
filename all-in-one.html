<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cyber MITM Lab – All-in-one View</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#0f172a; --panel:#111827; --panel2:#1f2937; --accent:#38bdf8; --text:#e5e7eb; --muted:#93a1b2; }
    body { margin:0; font-family: system-ui, Arial, sans-serif; background:var(--bg); color:var(--text); }
    header, main { max-width:1060px; margin:0 auto; padding:1.25rem; }
    h1 { margin:.25rem 0 .5rem; font-size:clamp(1.6rem,3.8vw,2.4rem); }
  /* Neutralize standard link appearance; buttons will represent actions */
  a { color:inherit; text-decoration:none; }
  a:hover { text-decoration:none; }
    nav { display:flex; gap:.75rem; align-items:center; justify-content:space-between; flex-wrap:wrap; }
  .btn { display:inline-flex; align-items:center; gap:.35rem; background:#334155; color:#e2e8f0; border:1px solid #475569; padding:.45rem .8rem; border-radius:8px; text-decoration:none; }
  .btn:hover { filter:brightness(1.08); text-decoration:none; }
  .btn-accent { background:#38bdf8; color:#082f49; border-color:#0891b2; }
    section { background:var(--panel2); border:1px solid #374151; border-radius:12px; margin:1rem 0; overflow:hidden; }
    section > header { background:var(--panel); padding:.75rem 1rem; border-bottom:1px solid #374151; }
    section > header h2 { margin:0; font-size:1rem; letter-spacing:.02em; text-transform:uppercase; color:#cbd5e1; }
    .content { padding:1rem; }
    pre { background:#0d1117; color:#e5e7eb; padding:.75rem 1rem; border-radius:8px; overflow:auto; font-size:.85rem; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    details { background:transparent; }
    details > summary { cursor:pointer; list-style:none; font-weight:600; color:#e5e7eb; }
    details > summary::-webkit-details-marker { display:none; }
    footer { text-align:center; color:#93a1b2; padding:2rem 1rem 3rem; }
    /* light mode */
    body[data-theme="light"] { --bg:#f1f5f9; --panel:#f8fafc; --panel2:#ffffff; --text:#0f172a; --muted:#475569; }
  body[data-theme="light"] pre { background:#e2e8f0; color:#0f172a; }
  /* Light mode: buttons */
  body[data-theme="light"] .btn { background:#e5e7eb; color:#0f172a; border-color:#cbd5e1; }
  body[data-theme="light"] .btn-accent { background:#0ea5e9; color:#042f2e; border-color:#0284c7; }
  /* Match theme toggle placement to index.html (fixed top-right) */
  #themeToggle { position:fixed; top:7%; right:9%; z-index:1000; padding:.34rem .50rem; font-size:.82rem; line-height:1.05; border-radius:4px; }
  /* AI generation badge */
  .ai-badge { display:inline-block; font-size:.55rem; letter-spacing:.08em; font-weight:700; text-transform:uppercase; padding:.3rem .55rem; border-radius:6px; background:linear-gradient(135deg,#1f2937,#111827); color:var(--accent); border:1px solid #374151; box-shadow:0 2px 6px -2px #000; position:relative; top:-.1rem; margin-left:.35rem; }
  body[data-theme="light"] .ai-badge { background:linear-gradient(135deg,#f1f5f9,#ffffff); color:#0ea5e9; border-color:#cbd5e1; }
    .quick-links { display:flex; flex-wrap:wrap; gap:.5rem; margin:.75rem 0 0; }
    .quick-links-label { font-size:.75rem; color:var(--muted); margin-right:.25rem; letter-spacing:.05em; text-transform:uppercase; }
    .tab-active { box-shadow:0 0 0 2px var(--accent) inset; position:relative; }
    .tab-active::after { content:""; position:absolute; left:8px; right:8px; bottom:-6px; height:3px; background:var(--accent); border-radius:2px; }
    .panel.loading::before { content:"Loading..."; display:block; font-size:.8rem; color:var(--muted); margin-bottom:.5rem; }
    .error { color:#f87171; font-weight:600; }
  </style>
</head>
<body>
  <header>
    <nav>
      <div>
        <h1>Cyber MITM Lab – All-in-one View</h1>
        <span class="ai-badge" title="Aggregated view & UI generated by AI; original lab code preserved">AI-GENERATED UI</span>
        <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
          <a class="btn" href="index.html">Demo Page</a>
          <a class="btn" href="https://github.com/JosephPotapenko/Cyber-MITM-Attack-Lab" target="_blank" rel="noopener">GitHub Repo</a>
        </div>
      </div>
      <div>
        <button id="themeToggle" class="btn">Switch to light mode</button>
      </div>
    </nav>
    <div class="quick-links" aria-label="Quick file tabs">
      <span class="quick-links-label">Files</span>
      <button class="btn btn-accent" data-file="sniffer1.py" data-type="code" title="Python sniffer/forwarder using Scapy">sniffer1.py</button>
      <button class="btn" data-file="lab2setup.sh" data-type="code" title="iptables setup script">lab2setup.sh</button>
      <button class="btn" data-file="lab2teardown.sh" data-type="code" title="iptables teardown script">lab2teardown.sh</button>
      <button class="btn" data-file="README.md" data-type="code" title="Detailed guide">README.md</button>
      <button class="btn" data-file="ReadMe.txt" data-type="code" title="Original short readme">ReadMe.txt</button>
      <button class="btn" data-file="index.html" data-type="code" title="Interactive demo page (HTML)">index.html</button>
      <button class="btn" data-file="Lab2.pdf" data-type="pdf" title="Lab 2 PDF">Lab2.pdf</button>
      <button class="btn" data-file="Lab2_jpotapenko.pdf" data-type="pdf" title="Alternate Lab 2 PDF">Lab2_jpotapenko.pdf</button>
    </div>
  </header>
  <main>
    <section id="dynamicSection">
      <header><h2 id="dynamicTitle">Viewer</h2></header>
      <div class="content panel" id="dynamicPanel">
        <div id="hint" style="font-size:.85rem;color:var(--muted);margin-bottom:.75rem;">Select a file tab above to display its contents here. Default loads README.md.</div>
        <div id="pdfWrapper" style="display:none;">
          <object id="pdfObj" type="application/pdf" width="100%" height="720" style="border:1px solid #374151;border-radius:8px;background:#111827;"></object>
        </div>
        <pre id="codeWrapper" style="display:none;"><code id="codeContent"></code></pre>
      </div>
    </section>
    <section>
      <header><h2>Embedded README snapshot</h2></header>
      <div class="content">
        <pre><code># Cyber-MITM-Attack-Lab

This lab demonstrates low-level packet manipulation, local redirection with iptables, and HTTP traffic inspection using Scapy—core skills for understanding practical man-in-the-middle (MITM) techniques on plaintext HTTP.

## Files

- sniffer1.py – Scapy-based sniffer/forwarder that:
  - Listens for redirected outbound HTTP packets on port 8080
  - Prints [HTTP] host/path when it recognizes an HTTP request
  - Prints [CENSORED] and drops any request containing the keyword frankenstein
  - Forwards permitted traffic to real destination port 80 and logs "Your packet has been forwarded to port 80"
- lab2setup.sh – Adds iptables rules: DNAT outbound TCP dport 80 (non-root) to local :8080 and drops RST/RST,ACK packets to keep flows stable
- lab2teardown.sh – Removes the iptables rules added during setup
- index.html – A self-contained HTML demo that explains the lab, shows example output, and includes a small client-side simulation of the decision logic

## Requirements

- Linux
- Python 3
- scapy (pip3 install scapy)
- iptables (run scripts with sudo/root)

## Quick start

0) Install dependencies (one time)

pip3 install scapy

1) Setup redirection rules

sudo ./lab2setup.sh

2) Run the sniffer

sudo python3 sniffer1.py

3) Generate HTTP traffic (e.g., using a non-root browser or curl http://example.com/), observe console logs, then stop with Ctrl+C.

4) Optional cleanup

sudo ./lab2teardown.sh

## How to test (examples)

Run these in a separate, non-root terminal while the sniffer is running. Because the iptables rule excludes root, do not prefix with sudo.

Forwarded (no body → may show "No Payload Found"):

curl http://example.com/books

Forwarded (POST body allowed):

curl -X POST -d "q=hello" http://example.com/search

Censored (POST body contains the keyword):

curl -X POST -d "q=frankenstein" http://example.com/search

Expected console snippets:

[HTTP] example.com/books
Your packet has been forwarded to port 80

[HTTP] example.com/search
[CENSORED]

## HTML demo

- Open index.html directly in your browser to read an overview and try the client-side simulation of the censor/forward logic.
- If you prefer a local server:

python3 -m http.server 8000
# then open http://localhost:8000/index.html

The demo includes a link back to the full source on GitHub so you can explore the code in context.

Also see the consolidated view at all-in-one.html, which shows the code, README content, and lab PDFs in one place.

## Notes

- Applies only to plaintext HTTP, not HTTPS/TLS.
- Simplistic keyword filter and no TCP stream reassembly (expects a request within a single packet for the demo).
<!-- README snapshot kept minimal intentionally -->
# Cyber-MITM-Attack-Lab (snapshot)
Low-level packet manipulation, local redirection, and HTTP traffic inspection using Scapy.
See live README via tab above for latest content.
def get_payload(pkt):
    if not (IP in pkt and TCP in pkt):
        return b""

    # start from IP layer and walk the payload chain
    layer = pkt[IP]
    while hasattr(layer, "payload") and type(layer.payload) is not NoPayload:
        layer = layer.payload

    if hasattr(layer, "load"):
        return layer.load
    return b""

def packet_sniffer(pkt):
    if not (IP in pkt and TCP in pkt):
        print("No payload")
        return

    # only handle packets going to port 8080
    if pkt[TCP].dport != 8080:
        return

    payload = get_payload(pkt)

    info = http_info(payload)
    if info:
        host, path = info
        print(f"[HTTP] {host}{path}")

    if CENSOR in payload:
        print("[CENSORED]")
        return

    ip = pkt[IP]
    tcp = pkt[TCP]
    new_pkt = IP(src=ip.src, dst=ip.dst, ttl=ip.ttl, tos=ip.tos)/TCP(
        sport=tcp.sport, dport=80, seq=tcp.seq, ack=tcp.ack,
        flags=tcp.flags, window=tcp.window, options=tcp.options)

    if payload:
        new_pkt = new_pkt/payload

    del new_pkt[IP].chksum
    del new_pkt[TCP].chksum
    send(new_pkt, verbose=0)
    print("Your packet has been forwarded to port 80")

if __name__ == "__main__":
    print("The packet sniffer is starting now. Type Ctrl+C to stop sniffing:")
    try:
        sniff(prn=packet_sniffer, filter="tcp and port 8080", store=0)
    except KeyboardInterrupt:
        print("Stopped.")
</code></pre>
      </div>
    </section>
    <section>
      <header><h2>Code: lab2setup.sh</h2></header>
      <div class="content">
        <pre><code>#!/bin/bash

echo "Welcome to the program!"
echo "First, the code will setup the iptables, and drop RST packets."
echo "-"

sudo iptables -t nat -A OUTPUT -p tcp -m owner ! --uid-owner root --dport 80 -j DNAT --to :8080
sudo iptables -I OUTPUT -p tcp --tcp-flags ALL RST,ACK -j DROP
sudo iptables -I OUTPUT -p tcp --tcp-flags ALL RST -j DROP
sudo iptables -I INPUT -p tcp --tcp-flags ALL RST -j DROP
sudo iptables -I INPUT -p tcp --tcp-flags ALL RST,ACK -j DROP

echo "Now, run sniffer1.py"
</code></pre>
      </div>
    </section>
    <section>
      <header><h2>Code: lab2teardown.sh</h2></header>
      <div class="content">
        <pre><code>echo "Now that you have ended the program, the bash script will now delete the iptable changes we made."
echo "-"

sudo iptables -t nat -D OUTPUT -p tcp -m owner ! --uid-owner root --dport 80 -j DNAT --to :8080
sudo iptables -D OUTPUT -p tcp --tcp-flags ALL RST,ACK -j DROP
sudo iptables -D OUTPUT -p tcp --tcp-flags ALL RST -j DROP
sudo iptables -D INPUT -p tcp --tcp-flags ALL RST -j DROP
sudo iptables -D INPUT -p tcp --tcp-flags ALL RST,ACK -j DROP

echo "Thank-you for using our program!"
</code></pre>
      </div>
    </section>
    <section>
      <header><h2>Lab PDFs</h2></header>
      <div class="content">
        <ul>
          <li><a href="Lab2.pdf" target="_blank" rel="noopener">Lab2.pdf</a></li>
          <li><a href="Lab2_jpotapenko.pdf" target="_blank" rel="noopener">Lab2_jpotapenko.pdf</a></li>
        </ul>
        <details>
          <summary>Inline preview (may not work in all browsers)</summary>
          <object data="Lab2.pdf" type="application/pdf" width="100%" height="600">
            <p>PDF preview unavailable. <a href="Lab2.pdf" target="_blank" rel="noopener">Open Lab2.pdf</a></p>
          </object>
        </details>
      </div>
    </section>
  </main>
  <footer>
    <span style="display:block;margin-bottom:.5rem;color:#93a1b2;">UI aggregation and this consolidated page were generated by AI; original lab code and materials are in the repository.</span>
    <span>Consolidated view &copy; 2025.</span>
    <a class="btn" href="https://github.com/JosephPotapenko/Cyber-MITM-Attack-Lab" target="_blank" rel="noopener">View on GitHub</a>
  </footer>
  <script>
    (function(){
      const key = 'theme';
      const btn = document.getElementById('themeToggle');
      const apply = (mode)=>{
        if(mode === 'light'){
          document.body.setAttribute('data-theme','light');
          btn.textContent = 'Switch to dark mode';
        } else {
          document.body.removeAttribute('data-theme');
          btn.textContent = 'Switch to light mode';
        }
      };
      let saved = localStorage.getItem(key) || 'dark';
      apply(saved);
      btn.addEventListener('click', ()=>{
        saved = (saved === 'dark') ? 'light' : 'dark';
        localStorage.setItem(key, saved);
        apply(saved);
      });
      // Tab / dynamic loader
      const buttons = Array.from(document.querySelectorAll('.quick-links button'));
      const codeWrapper = document.getElementById('codeWrapper');
      const codeContent = document.getElementById('codeContent');
      const pdfWrapper = document.getElementById('pdfWrapper');
      const pdfObj = document.getElementById('pdfObj');
      const dynTitle = document.getElementById('dynamicTitle');
      const hint = document.getElementById('hint');
      const panel = document.getElementById('dynamicPanel');
      function activate(btn){
        buttons.forEach(b=>b.classList.remove('tab-active','btn-accent'));
        btn.classList.add('tab-active');
        if(!btn.classList.contains('btn-accent')) btn.classList.add('btn-accent');
      }
      function loadFile(file,type){
        panel.classList.add('loading');
        dynTitle.textContent = file;
        hint.style.display='none';
        codeWrapper.style.display='none';
        pdfWrapper.style.display='none';
        if(type==='pdf'){
          pdfWrapper.style.display='';
          pdfObj.data = file;
          panel.classList.remove('loading');
          return;
        }
        fetch(file).then(r=>{ if(!r.ok) throw new Error(r.status); return r.text(); })
          .then(txt=>{ codeContent.textContent = txt; codeWrapper.style.display=''; })
          .catch(e=>{ codeContent.innerHTML = ''; codeWrapper.style.display=''; codeContent.textContent = `Failed to load ${file}: ${e.message}`; codeContent.classList.add('error'); })
          .finally(()=> panel.classList.remove('loading'));
      }
      buttons.forEach(btnEl=>{
        btnEl.addEventListener('click',()=>{
          activate(btnEl);
          loadFile(btnEl.dataset.file, btnEl.dataset.type);
        });
      });
      // Auto-load README.md on first visit
      const defaultBtn = buttons.find(b=>b.dataset.file==='README.md') || buttons[0];
      if(defaultBtn){ defaultBtn.click(); }
    })();
  </script>
</body>
</html>